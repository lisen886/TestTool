{% extends "baseNavbar.html" %}
{% block title %}Test Tool | Perf{% endblock %}
{% block page_content %}
<div class="container">
	<div class="row clearfix">
		<div class="col-md-12 column">
			<div class="panel panel-primary">
				<div class="panel-heading">
					<h3 class="panel-title">
						请选择
					</h3>
				</div>
                <div class="panel-body">
                    <table class="table table-striped table-condensed">
				<tbody>
					<tr>
                        <td width='3%'>
                            Version：
                        </td>
						<td>
                            <input type="checkbox" id="version" onclick="checkOrCancelAll(this.id)">&nbsp;all&nbsp;&nbsp;
                            {% for version in versions %}
                                <input type="checkbox" name="version" value={{ version }}>&nbsp;{{ version }}&nbsp;&nbsp;
                            {% endfor %}
                        </td>
					</tr>
                    <tr>
                        <td>
                            Browser：
                        </td>
						<td>
                            <input type="checkbox" id="browser" onclick="checkOrCancelAll(this.id)">&nbsp;all&nbsp;&nbsp;
                            {% for browser in browsers %}
                                <input type="checkbox" name="browser" value={{ browser }}>&nbsp;{{ browser }}&nbsp;&nbsp;
                            {% endfor %}
                        </td>
					</tr>
                    <tr>
                        <td>
                            Mode：
                        </td>
						<td>
                            <input type="checkbox" id="mode" onclick="checkOrCancelAll(this.id)">&nbsp;all&nbsp;&nbsp;
                            {% for mode in modes %}
                                <input type="checkbox" name="mode" value={{ mode }}>&nbsp;{{ mode }}&nbsp;&nbsp;
                            {% endfor %}
                        </td>
					</tr>
                    <tr>
                        <td>
                            Codec：
                        </td>
						<td>
                            <input type="checkbox" id="codec" onclick="checkOrCancelAll(this.id)">&nbsp;all&nbsp;&nbsp;
                            {% for codec in codecs %}
                                <input type="checkbox" name="codec" value={{ codec }}>&nbsp;{{ codec }}&nbsp;&nbsp;
                            {% endfor %}
                        </td>
					</tr>
                    <tr>
                        <td>
                            Index：
                        </td>
						<td>
                            <input type="checkbox" id="index" onclick="checkOrCancelAll(this.id)">&nbsp;all&nbsp;&nbsp;
                            <input type="checkbox" name="index" value="内存">&nbsp;内存&nbsp;&nbsp;
                            <input type="checkbox" name="index" value="CPU">&nbsp;CPU&nbsp;&nbsp;
                            <input type="checkbox" name="index" value="首帧出图">&nbsp;首帧出图&nbsp;&nbsp;
                            <input type="checkbox" name="index" value="视频延时">&nbsp;内存&nbsp;&nbsp;
                            <input type="checkbox" name="index" value="视频卡顿率">&nbsp;视频卡顿率&nbsp;&nbsp;
                            <input type="checkbox" name="index" value="音频延时">&nbsp;音频延时&nbsp;&nbsp;
                            <input type="checkbox" name="index" value="音频抗丢包边界">&nbsp;音频抗丢包边界&nbsp;&nbsp;
                            <input type="checkbox" name="index" value="音画同步">&nbsp;音画同步&nbsp;&nbsp;
                        </td>
					</tr>
				</tbody>
			</table>
				</div>
                <div class="panel-footer">
                    <button type="button" class="btn btn-primary" onclick="search()" id="btn_search">查找</button>
                </div>
            </div>
		</div>
	</div>
</div>

<div id="main" style="width: 1000px;height:500px"></div>
{% endblock %}
{% block scripts %}
{{ super() }}
    <script type="text/javascript" src="http://cdn.static.runoob.com/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="{{ url_for('static', filename='js/echarts.js') }}"></script>
{#    <script src="https://cdn.bootcss.com/echarts/4.6.0/echarts.js"></script>#}
    <script type="text/javascript">
    var myChart = echarts.init(document.getElementById('main'));
    option = {
    title: {
        text: 'title', //可自定义
        show:false
    },
    tooltip : {
        trigger: 'axis'
    },
    legend: {
        data:[]
    },
    toolbox: {
        feature: {
            dataZoom: {
               yAxisIndex: 'none'
            }, //区域缩放，区域缩放还原
            magicType: {
                type: ['line', 'bar']
                },  //切换为折线图，切换为柱状图
            restore: {},  //还原
            saveAsImage: {}
        }
    },
    grid: {
        left: '3%',
        right: '3%',
        top:"5%",
        bottom: '5%',// 控制图表上下左右的空白尺寸
        containLabel: true, //自适应画布大小
    },
    xAxis : [
        {
            type : 'category',
            boundaryGap : false,
            data : []// X轴的定义
        }
    ],
    yAxis : [
        {
            type : 'value'// Y轴的定义
        }
    ],
    series : []// 数据
};
    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);
    myChart.showLoading();    //数据加载完之前先显示一段简单的loading动画

    function checkOrCancelAll(value){
        //1.获取checkbo的元素对象
        var chElt=document.getElementById(value);
        //2.获取选中状态
        var checkedElt=chElt.checked;
        //3.若checked=true,将所有的复选框选中,checked=false,将所有的复选框取消
        var allCheck=document.getElementsByName(value);
        //4.循环遍历取出每一个复选框中的元素
        if(checkedElt){
            //全选
            for(var i=0;i<allCheck.length;i++){
                //设置复选框的选中状态
                allCheck[i].checked=true;
            }
        }else{
            //取消全选
            for(var i=0;i<allCheck.length;i++){
                allCheck[i].checked=false;
            }
        }
    }

    function search() {
        let version_checkList =new Array();
        let browser_checkList =new Array();
        let mode_checkList =new Array();
        let codec_checkList =new Array();
        let index_checkList =new Array();
        let obj_version = document.getElementsByName("version");
        for (let i = 0; i < obj_version.length; i++) {
                if (obj_version[i].checked)
                    version_checkList.push(obj_version[i].value);
        }
        let obj_browser = document.getElementsByName("browser");
        for (let i = 0; i < obj_browser.length; i++) {
                if (obj_browser[i].checked)
                    browser_checkList.push(obj_browser[i].value);
        }
        let obj_mode = document.getElementsByName("mode");
        for (let i = 0; i < obj_mode.length; i++) {
                if (obj_mode[i].checked)
                    mode_checkList.push(obj_mode[i].value);
        }
        let obj_codec = document.getElementsByName("codec");
        for (let i = 0; i < obj_codec.length; i++) {
                if (obj_codec[i].checked)
                    codec_checkList.push(obj_codec[i].value);
        }
        let obj_index = document.getElementsByName("index");
        for (let i = 0; i < obj_index.length; i++) {
                if (obj_index[i].checked)
                    index_checkList.push(obj_index[i].value);
        }
        if (index_checkList.length ==0){
            alert("请选择正确的指标！！！")
        }
        $.ajax({
             type : "post",
             url : "/showQearyResult",    //请求发送到Servlet处
             dataType : "json",        //返回数据形式为json
             data:{
                 version_check:JSON.stringify(version_checkList),
                 browser_check:JSON.stringify(browser_checkList),
                 mode_check:JSON.stringify(mode_checkList),
                 codec_check:JSON.stringify(codec_checkList),
                 index_check:JSON.stringify(index_checkList)
             },
             error:function(){
                    alert('请求数据失败,请检查选择条件！');
                    myChart.hideLoading();
                },success:function (jsons){
                    if (jsons) {
                        console.log(jsons);
                        var Item = function(){
                    return {
                        name:'',
                        type:'line',
                        {#smooth:true,  //这个是把线变成曲线#}
                        label: {normal: {show: true,position: 'top'}}, // 显示每个点的数值
                        {#markLine: {data: [{type: 'average', name: '平均值'}]},#}
                        data:[],
                        }
                    };
                        var legends = [];
                        var Series = [];
                        var json = jsons.data;
                        for(var i=0;i < json.length;i++){
                            var it = new Item();
                            it.name = json[i].name;
                            legends.push(json[i].name);
                            it.data = json[i].data;
                            Series.push(it);
                        }
                        option.xAxis[0].data = json[0].xcontent;
                        option.legend.data = legends;
                        option.series = Series; // 设置图表
                        myChart.hideLoading();    //隐藏加载动画
                        myChart.setOption(option,true);// 重新加载图表
                    }
                }
        });

    }
    </script>
{% endblock %}